name: Build

on: [ pull_request, workflow_dispatch ]

permissions: read-all

jobs:
  build:
    runs-on: macos-15
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Set up Xcode
        run: |
          xcodebuild -version
#          sudo xcode-select -s "/Applications/Xcode_16.app"
      - name: Allow macro
        run: |
          defaults write com.apple.dt.Xcode IDESkipMacroFingerprintValidation -bool YES
      - name: Build
        uses: yukiarrr/ios-build-action@v1.12.0
        with:
          project-path: Chato.xcodeproj
          # Required GitHub Secrets (set in repository Settings â†’ Secrets):
          # - CERTIFICATES_P12: Base64-encoded .p12 certificate file
          # - CERTIFICATES_P12_PASSWORD: Password for the .p12 certificate
          # - MOBILEPROVISION: Base64-encoded .mobileprovision file (App Store Distribution)
          # - CODE_SIGN_IDENTITY: Exact certificate name (e.g., "Apple Distribution: Your Name")
          # - TEAM_ID: Your Apple Developer Team ID
          # Note: If build fails with "provisioning profile expired", update MOBILEPROVISION secret
          # See .github/CI_TROUBLESHOOTING.md for detailed instructions
          p12-base64: ${{ secrets.CERTIFICATES_P12 }}
          certificate-password: ${{secrets.CERTIFICATES_P12_PASSWORD}}
          mobileprovision-base64: ${{ secrets.MOBILEPROVISION }}
          code-signing-identity: ${{ secrets.CODE_SIGN_IDENTITY }}
          team-id: ${{ secrets.TEAM_ID }}
          export-method: app-store
          configuration: Release
          output-path: output.ipa
